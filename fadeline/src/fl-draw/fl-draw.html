<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="./fl-draw-style.html">


<script src="../../node_modules/pressure/dist/pressure.min.js"></script>
<script src="../../node_modules/p5/lib/p5.min.js"></script> 
    
<!-- <script src="./src/pep.js"></script> -->
<!-- <script src="../paint/paint0.js"></script> -->

<script src="./src/pointstorage.js"></script>
<script src="./src/pointsketch.js" ></script>

<dom-module id="fl-draw">
  <template>
    <style include="fl-draw-style"></style>

    <div id="pane"></div>
    <!-- <canvas id="pane1" touch-action="none"></canvas>  -->
    <!-- <div id="pane2"></div>  -->

  </template>

  <script>
    /**
     * Globals
     */
    let pStore ; 
    let pSketch;

    // function test(document){

    //     document.getElementById("pane1").addEventListener("pointerdown", function (e) {
    //         document.getElementById("pane2").innerHTML = "that was a " +
    //             e.pointerType + " " + e.type + " on a " + e.target.nodeName;
    //     });
    // }


    /**
     * @customElement
     * @polymer
     */
    class FlDraw extends Polymer.Element {

       

      static get is() { return 'fl-draw'; }

      static get properties() {
        return {
          flow:   { type: Number, value: 255,    notify: true },
          width:  { type: Number, value: 400,    notify: true },
          height: { type: Number, value: 300,    notify: true },
          size:   { type: Number, value: 3,      notify: true },
          color:  { type: String, value: "#000000", notify: true },
          flowP:  { type: Number, reflectToAttribute:false, computed: "computeFlowP(flow)"
          }
        };
      }
      
      computeFlowP(flow){
        return 100*flow/255;
      }

      ready (){
        super.ready();

        let dpane=this.shadowRoot.getElementById('pane');
        dpane.style.width=`${this.width}px`;
        dpane.style.height=`${this.height}px`;

        pStore= PointStorage(this);
        pStore.attachEventHandlers(dpane); //join lines?
        pSketch = PointSketch(dpane,this.width,this.height,pStore.points,this);

        //test(this.shadowRoot); !!!!!
        // var painter = new Paint({el: this.shadowRoot.getElementById('pane1')});
      }
    }

    window.customElements.define(FlDraw.is, FlDraw);

  </script>

</dom-module>