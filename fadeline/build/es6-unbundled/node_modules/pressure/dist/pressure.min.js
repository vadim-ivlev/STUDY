!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.Pressure=b()}(this,function(){"use strict";function j(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},q=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),o=function(){function a(b,c,d){k(this,a),this.routeEvents(b,c,d),this.preventSelect(b,d)}return q(a,[{key:"routeEvents",value:function(a,b,d){var e=c.get("only",d);this.adapter=u&&("pointer"===e||null===e)?new l(a,b,d).bindEvents():p&&("touch"===e||null===e)?new h(a,b,d).bindEvents():f&&("mouse"===e||null===e)?new r(a,b,d).bindEvents():new i(a,b).bindUnsupportedEvent()}},{key:"preventSelect",value:function(a,b){c.get("preventSelect",b)&&(a.style.webkitTouchCallout="none",a.style.webkitUserSelect="none",a.style.khtmlUserSelect="none",a.style.MozUserSelect="none",a.style.msUserSelect="none",a.style.userSelect="none")}}]),a}(),i=function(){function a(b,c,d){k(this,a),this.el=b,this.block=c,this.options=d,this.pressed=!1,this.deepPressed=!1,this.nativeSupport=!1,this.runningPolyfill=!1,this.runKey=Math.random()}return q(a,[{key:"setPressed",value:function(a){this.pressed=a}},{key:"setDeepPressed",value:function(a){this.deepPressed=a}},{key:"isPressed",value:function(){return this.pressed}},{key:"isDeepPressed",value:function(){return this.deepPressed}},{key:"add",value:function(a,b){this.el.addEventListener(a,b,!1)}},{key:"runClosure",value:function(a){a in this.block&&this.block[a].apply(this.el,Array.prototype.slice.call(arguments,1))}},{key:"fail",value:function(a,b){c.get("polyfill",this.options)?this.runKey===b&&this.runPolyfill(a):this.runClosure("unsupported",a)}},{key:"bindUnsupportedEvent",value:function(){var a=this;this.add(p?"touchstart":"mousedown",function(b){return a.runClosure("unsupported",b)})}},{key:"_startPress",value:function(a){!1===this.isPressed()&&(this.runningPolyfill=!1,this.setPressed(!0),this.runClosure("start",a))}},{key:"_startDeepPress",value:function(a){this.isPressed()&&!1===this.isDeepPressed()&&(this.setDeepPressed(!0),this.runClosure("startDeepPress",a))}},{key:"_changePress",value:function(a,b){this.nativeSupport=!0,this.runClosure("change",a,b)}},{key:"_endDeepPress",value:function(){this.isPressed()&&this.isDeepPressed()&&(this.setDeepPressed(!1),this.runClosure("endDeepPress"))}},{key:"_endPress",value:function(){!1===this.runningPolyfill?(this.isPressed()&&(this._endDeepPress(),this.setPressed(!1),this.runClosure("end")),this.runKey=Math.random(),this.nativeSupport=!1):this.setPressed(!1)}},{key:"deepPress",value:function(a,b){.5<=a?this._startDeepPress(b):this._endDeepPress()}},{key:"runPolyfill",value:function(a){this.increment=0===c.get("polyfillSpeedUp",this.options)?1:10/c.get("polyfillSpeedUp",this.options),this.decrement=0===c.get("polyfillSpeedDown",this.options)?1:10/c.get("polyfillSpeedDown",this.options),this.setPressed(!0),this.runClosure("start",a),!1===this.runningPolyfill&&this.loopPolyfillForce(0,a)}},{key:"loopPolyfillForce",value:function(a,b){!1===this.nativeSupport&&(this.isPressed()?(this.runningPolyfill=!0,a=1<a+this.increment?1:a+this.increment,this.runClosure("change",a,b),this.deepPress(a,b),setTimeout(this.loopPolyfillForce.bind(this,a,b),10)):(a=0>a-this.decrement?0:a-this.decrement,.5>a&&this.isDeepPressed()&&(this.setDeepPressed(!1),this.runClosure("endDeepPress")),0===a?(this.runningPolyfill=!1,this.setPressed(!0),this._endPress()):(this.runClosure("change",a,b),this.deepPress(a,b),setTimeout(this.loopPolyfillForce.bind(this,a,b),10))))}}]),a}(),r=function(a){function b(a,c,d){return k(this,b),j(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d))}return e(b,a),q(b,[{key:"bindEvents",value:function(){this.add("webkitmouseforcewillbegin",this._startPress.bind(this)),this.add("mousedown",this.support.bind(this)),this.add("webkitmouseforcechanged",this.change.bind(this)),this.add("webkitmouseforcedown",this._startDeepPress.bind(this)),this.add("webkitmouseforceup",this._endDeepPress.bind(this)),this.add("mouseleave",this._endPress.bind(this)),this.add("mouseup",this._endPress.bind(this))}},{key:"support",value:function(a){!1===this.isPressed()&&this.fail(a,this.runKey)}},{key:"change",value:function(a){this.isPressed()&&0<a.webkitForce&&this._changePress(this.normalizeForce(a.webkitForce),a)}},{key:"normalizeForce",value:function(a){return this.reachOne(n(a,1,3,0,1))}},{key:"reachOne",value:function(a){return .995<a?1:a}}]),b}(i),h=function(a){function c(a,b,d){return k(this,c),j(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a,b,d))}return e(c,a),q(c,[{key:"bindEvents",value:function(){b?(this.add("touchforcechange",this.start.bind(this)),this.add("touchstart",this.support.bind(this,0)),this.add("touchend",this._endPress.bind(this))):(this.add("touchstart",this.startLegacy.bind(this)),this.add("touchend",this._endPress.bind(this)))}},{key:"start",value:function(a){0<a.touches.length&&(this._startPress(a),this.touch=this.selectTouch(a),this.touch&&this._changePress(this.touch.force,a))}},{key:"support",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.runKey;!1===this.isPressed()&&(6>=a?(a++,setTimeout(this.support.bind(this,a,b,c),10)):this.fail(b,c))}},{key:"startLegacy",value:function(a){this.initialForce=a.touches[0].force,this.supportLegacy(0,a,this.runKey,this.initialForce)}},{key:"supportLegacy",value:function(a,b,c,d){d===this.initialForce?6>=a?(a++,setTimeout(this.supportLegacy.bind(this,a,b,c,d),10)):this.fail(b,c):(this._startPress(b),this.loopForce(b))}},{key:"loopForce",value:function(a){this.isPressed()&&(this.touch=this.selectTouch(a),setTimeout(this.loopForce.bind(this,a),10),this._changePress(this.touch.force,a))}},{key:"selectTouch",value:function(a){if(1===a.touches.length)return this.returnTouch(a.touches[0],a);for(var b=0;b<a.touches.length;b++)if(a.touches[b].target===this.el||this.el.contains(a.touches[b].target))return this.returnTouch(a.touches[b],a)}},{key:"returnTouch",value:function(a,b){return this.deepPress(a.force,b),a}}]),c}(i),l=function(a){function b(a,c,d){return k(this,b),j(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d))}return e(b,a),q(b,[{key:"bindEvents",value:function(){this.add("pointerdown",this.support.bind(this)),this.add("pointermove",this.change.bind(this)),this.add("pointerup",this._endPress.bind(this)),this.add("pointerleave",this._endPress.bind(this))}},{key:"support",value:function(a){!1===this.isPressed()&&(0===a.pressure||.5===a.pressure?this.fail(a,this.runKey):(this._startPress(a),this._changePress(a.pressure,a)))}},{key:"change",value:function(a){this.isPressed()&&0<a.pressure&&.5!==a.pressure&&(this._changePress(a.pressure,a),this.deepPress(a.pressure,a))}}]),b}(i),c={polyfill:!0,polyfillSpeedUp:1e3,polyfillSpeedDown:0,preventSelect:!0,only:null,get:function(a,b){return b.hasOwnProperty(a)?b[a]:this[a]},set:function(a){for(var b in a)a.hasOwnProperty(b)&&this.hasOwnProperty(b)&&"get"!=b&&"set"!=b&&(this[b]=a[b])}},d=function(b,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof b||b instanceof String)for(var f=document.querySelectorAll(b),g=0;g<f.length;g++)new o(f[g],c,d);else if(a(b))new o(b,c,d);else for(var g=0;g<b.length;g++)new o(b[g],c,d)},a=function(a){return"object"===("undefined"==typeof HTMLElement?"undefined":m(HTMLElement))?a instanceof HTMLElement:a&&"object"===(void 0===a?"undefined":m(a))&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName},n=function(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d},f=!1,p=!1,u=!1,s=!1,b=!1;if("undefined"!=typeof window){if("undefined"!=typeof Touch)try{(Touch.prototype.hasOwnProperty("force")||"force"in new Touch)&&(s=!0)}catch(a){}p="ontouchstart"in window.document&&s,f="onmousemove"in window.document&&!p,u="onpointermove"in window.document,b="ontouchforcechange"in window.document}return{set:function(a,b,c){d(a,b,c)},config:function(a){c.set(a)},map:function(){return n.apply(null,arguments)}}});