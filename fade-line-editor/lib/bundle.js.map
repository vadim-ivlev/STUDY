{"version":3,"sources":["../src/fadeline-draw.js","../src/fadeline-jquery.js"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["// import '../node_modules/jquery/dist/jquery.min.js'\n// import './fadeline-jquery.js'\n// globals ===========================================\nlet rgba={r:0,g:0,b:0,a:255}; // max values: 255\nlet strWeight=2; //pixels\nlet fadingTime=10000; //msec\nlet sig_k=15; \n\n\n\nfunction setup() {\n    var myCanvas = createCanvas(windowWidth, windowHeight * 0.5);\n    myCanvas.parent('pane');\n    noFill();\n    curveTightness(-0.5);\n    // blendMode(DIFFERENCE);    \n    // frameRate(30);\n    // noLoop();\n}\n\nfunction draw() {\n    clear();\n    redrawLastLines(fadingTime);\n}\n\nfunction redrawLastLines(timeSpan = 5000 ) {\n    for (let i =points.length  - 1; i > 2; i--) {\n        let a = getAlpha(timeSpan, i);\n        if (a < 0) {\n            //truncate poins?\n            // console.log('alpha <0'); \n            return;\n        }\n\n        // let coords = getLineCoords(i);\n        let coords = getCurveCoords(i);\n        if (coords==null) continue;\n\n        stroke(rgba.r, rgba.g, rgba.b, a * rgba.a);\n        strokeWeight(strWeight+a*strWeight);\n        curve(...coords);\n    }\n}\n\n\nfunction getCurveCoords(i){\n    var p1 =points[i],p2,p3,p4;    \n    p1 = points[i];\n    if (p1.action != 'move') return null; \n    p2 = points[i - 1];\n    if (p2.action != 'move') return [p1.x, p1.y, p1.x, p1.y, p2.x, p2.y, p2.x, p2.y]; \n    p3 = points[i - 2];\n    if (p3.action != 'move') return [p1.x, p1.y, p2.x, p2.y, p2.x, p2.y, p3.x, p3.y]; \n    p4 = points[i - 3];\n    return [p1.x, p1.y, p2.x, p2.y, p3.x, p3.y, p4.x, p4.y];\n}\n\n\n\nfunction getAlpha(timeSpan, i) {\n    let p1 = points[i];\n    let now=Date.now() ;\n    let dt=(now - p1.time);\n    let fading = lin(dt, timeSpan);\n    // let fading = sigmoid(dt, sig_k, timeSpan);\n    let alpha = fading * p1.pressure;\n\n    // if (fading>-0.1) console.log(points.length,fading);\n    // console.log(`now:${now} p.time:${p1.time} dt:${dt} alpha:${alpha}`)\n    return alpha;\n}\n\n/**\n * Linear fading function. Changes from 1 to 0\n * when x changes from 0 to n.\n * @param {*} x \n * @param {*} n \n */\nfunction lin(x,n) {return 1.0-x/n;} \n\n\n/**\n * Sigmoid fading function. Works well when k~10\n * @param {*} x \n * @param {*} k \n * @param {*} n \n */\nfunction sigmoid(x, k, n ) { return 1 / (Math.exp((k * (x - 0.5 * n)) / n) + 1); }\n\n\n// TODO \n// Leave the last 30 sec only of drawing;\n// All points in one line make the same time.\n// The user can change time before the lines start fading.\n// Add texture to lines.\n// Browserify all outer js dependancies through one lib.js","// import  './node_modules/jquery/dist/jquery.min.js'\n\n// DEFS --------------------------------------------\n\n// shows if pointer is down\nlet pointerDown = false;\n// pointer pressure while drawing\nlet press = 0;\n// array of points to draw\nconst points = [];\n\n// registers  touch evs\nconst pane = $('#pane');\n\n\n/**\n * Creates a record about pointer event and adds it\n * to the global array points[]. \n * pointer param describes what happend \n * to the pointer device: \"down\", \"up\" \n * @param {event} ev\n * @param {String} pointer \n */\nfunction pushPoint(ev, action) {\n    fixOffsets(ev);\n    let p = {\n        action,\n        eventType: ev.type,\n        x: (ev.offsetX),\n        y: (ev.offsetY),\n        pressure: press,\n        time: Date.now()\n    };\n    points.push(p);\n\n}\n\n\n// Handlers ================================\n// there are several place where you can add event handlers.\n// pointer events, mouse events, pressurejs events, touch events.\n// It's hard to tell what is the right choince if we want the app work\n// on any device\n\n\nfunction mouseover_handler(event) {\n    if (event.buttons)\n        pointerDown = true;\n    pushPoint(event, 'mouseover')\n}\n\n\nfunction mouseout_handler(event) {\n    pointerDown = false;\n    pushPoint(event, 'mouseout')\n}\n\n\nfunction movestart_handler(event) {\n    pointerDown = true;\n    pushPoint(event, 'movestart')\n}\n\n\nfunction moveend_handler(event={type:'up'}) {\n    pointerDown = false;\n    pushPoint(event, 'moveend')\n}\n\n\nfunction move_handler(event) {\n    if (pointerDown)\n        pushPoint(event, 'move');\n}\n\n\n/**\n * Quick fix.\n * add missing offxetX and offstY to the event\n * https://github.com/stephband/jquery.event.move\n * @param {*} ev \n */\nfunction fixOffsets(ev){\n    if (ev.offsetX || ev.offsetY) return;\n    let offset =pane.offset();\n    ev.offsetX = ((ev.pageX || 0) - offset.left) ;//+ $(window).scrollLeft();\n    ev.offsetY = ((ev.pageY || 0) - offset.top) ;//+ $(window).scrollTop();\n}\n\n// BEGIN ============================================\n\n// prevent the page from dragging in iOS\n// $(document).on('touchmove',(event) => event.preventDefault());\npane.on('touchmove', (event) => event.preventDefault());\n\n\n/**\n * Initializes pressurejs. \n */\n$('#pane').pressure({\n    change: (force, event) => { press = force; },\n    start: function (event) {},\n    end: function () {},\n    }, \n    { preventSelect: true, polyfillSpeedUp: 300 }\n);\n// function force_handler(force, event) { press = force; }\n\n\n\n\n// mouse events\npane.on('mouseover', mouseover_handler);\npane.on('mouseout', mouseout_handler);\n//pane.on('mousedown', down_handler);\n// pane.on('mouseup', up_handler);\n// pane.on('mousemove', move_handler)\n\n//pointer events\n//pane.on('pointermove' ,pointermove_handler);\n\n\n/**\n * move events abstract away the defaults \n * that need attention on dufferent devices.\n * https://github.com/stephband/jquery.event.move\n */\npane.on('movestart', movestart_handler);\npane.on('moveend', moveend_handler);\npane.on('move', move_handler);\n\n"]}